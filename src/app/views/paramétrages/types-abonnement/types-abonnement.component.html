<div class="gestion-types-abonnement-container">
    <div class="gestion-types-abonnement">
      <!-- Modal for Adding/Editing a Subscription -->
      <div class="modal" *ngIf="showModal" @modalAnimation>
        <div class="modal-content">
          <h2 class="modal-title">{{ isEditing ? '√âditer le type d\'abonnement' : 'Ajouter un type d\'abonnement' }}</h2>
          <form (ngSubmit)="saveSubscription()" #subscriptionForm="ngForm">
            <div class="form-group">
              <label>D√©signation</label>
              <input
                type="text"
                [(ngModel)]="currentSubscription.designation"
                name="designation"
                required
                #designation="ngModel"
                class="form-input"
                placeholder="Entrez la d√©signation"
              />
              <span class="error" *ngIf="designation.invalid && designation.touched">La d√©signation est requise</span>
            </div>
            <div class="form-group">
              <label>Dur√©e (mois)</label>
              <input
                type="number"
                [(ngModel)]="currentSubscription.duration"
                name="duration"
                required
                min="0"
                #duration="ngModel"
                class="form-input"
              />
              <span class="error" *ngIf="duration.invalid && duration.touched">La dur√©e doit √™tre un nombre ‚â• 0</span>
            </div>
            <div class="form-group">
              <label>Forfait (DT)</label>
              <input
                type="number"
                [(ngModel)]="currentSubscription.price"
                name="price"
                required
                min="0"
                step="0.01"
                #price="ngModel"
                class="form-input"
              />
              <span class="error" *ngIf="price.invalid && price.touched">Le forfait doit √™tre un montant valide ‚â• 0</span>
            </div>
            <div class="form-group">
              <label>Acc√®s Libre</label>
              <select
                [(ngModel)]="currentSubscription.freeAccess"
                name="freeAccess"
                required
                #freeAccess="ngModel"
                class="form-input"
              >
                <option [value]="true">Oui</option>
                <option [value]="false">Non</option>
              </select>
              <span class="error" *ngIf="freeAccess.invalid && freeAccess.touched">L'acc√®s libre est requis</span>
            </div>
            <div class="form-group">
              <label>S√©ances/semaine (-1 pour illimit√©)</label>
              <input
                type="number"
                [(ngModel)]="currentSubscription.weeklySessions"
                name="weeklySessions"
                required
                min="-1"
                #weeklySessions="ngModel"
                class="form-input"
              />
              <span class="error" *ngIf="weeklySessions.invalid && weeklySessions.touched">Les s√©ances doivent √™tre ‚â• -1</span>
            </div>
            <div class="form-group">
              <label>Statut</label>
              <select
                [(ngModel)]="currentSubscription.status"
                name="status"
                required
                #status="ngModel"
                class="form-input"
              >
                <option value="Actif">Actif</option>
                <option value="Inactif">Inactif</option>
              </select>
              <span class="error" *ngIf="status.invalid && status.touched">Le statut est requis</span>
            </div>
            <div class="modal-actions">
              <button type="button" class="cancel-btn" (click)="closeModal()">Annuler</button>
              <button type="submit" class="save-btn" [disabled]="!subscriptionForm.valid">Sauvegarder</button>
            </div>
          </form>
        </div>
      </div>
  
      <!-- Modal for Viewing a Subscription -->
      <div class="modal" *ngIf="showViewModal" @modalAnimation>
        <div class="modal-content">
          <h2 class="modal-title">D√©tails du type d'abonnement</h2>
          <div class="user-details">
            <p><strong>Code :</strong> {{ viewedSubscription?.code }}</p>
            <p><strong>D√©signation :</strong> {{ viewedSubscription?.designation }}</p>
            <p><strong>Dur√©e :</strong> {{ viewedSubscription?.duration }} mois</p>
            <p><strong>Forfait :</strong> {{ viewedSubscription?.price }} DT</p>
            <p><strong>Acc√®s Libre :</strong> {{ viewedSubscription?.freeAccess ? 'Oui' : 'Non' }}</p>
            <p><strong>S√©ances/semaine :</strong> {{ viewedSubscription?.weeklySessions === -1 ? 'Illimit√©' : viewedSubscription?.weeklySessions }}</p>
            <p><strong>Statut :</strong> <span [ngClass]="viewedSubscription?.status === 'Actif' ? 'active' : 'inactive'">{{ viewedSubscription?.status }}</span></p>
          </div>
          <div class="modal-actions">
            <button class="close-btn" (click)="closeViewModal()">Fermer</button>
          </div>
        </div>
      </div>
  
      <!-- Modal for Delete Confirmation -->
      <div class="modal" *ngIf="showDeleteConfirm" @modalAnimation>
        <div class="modal-content">
          <h2 class="modal-title">Confirmer la suppression</h2>
          <p class="modal-text">√ätes-vous s√ªr de vouloir supprimer le type d'abonnement {{ subscriptionToDelete?.code }} ?</p>
          <div class="modal-actions">
            <button class="cancel-btn" (click)="cancelDelete()">Annuler</button>
            <button class="delete-btn" (click)="deleteSubscription()">Supprimer</button>
          </div>
        </div>
      </div>
  
      <!-- Header Section -->
      <div class="header">
        <div class="header-title">
          <h1 class="text-blue-800 animate-fade-in">Types d'Abonnement</h1>
          <p class="text-gray-600 animate-fade-in">Configuration des types d'abonnement disponibles ({{ filteredSubscriptions.length }} types)</p>
        </div>
        <button class="add-btn bg-blue-600 hover:bg-blue-700 text-white" (click)="openAddSubscriptionModal()">+ Ajouter un type</button>
      </div>
  
      <!-- Search and Filter Section -->
      <div class="search-filter">
        <div class="search">
          <input
            type="text"
            placeholder="Rechercher un type d'abonnement..."
            [(ngModel)]="searchQuery"
            (input)="filterSubscriptions()"
            class="search-input"
          />
          <span class="search-icon">üîç</span>
        </div>
        <div class="filter-container">
          <button class="filter-btn" (click)="toggleFilter()">Filtrer ‚ñº</button>
          <div class="filter-dropdown" *ngIf="showFilter">
            <label class="filter-label">
              Dur√©e (mois) :
              <select [(ngModel)]="filterDuration" (change)="filterSubscriptions()" class="filter-select">
                <option value="">Tous</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="3">3</option>
                <option value="12">12</option>
              </select>
            </label>
            <label class="filter-label">
              Statut :
              <select [(ngModel)]="filterStatus" (change)="filterSubscriptions()" class="filter-select">
                <option value="">Tous</option>
                <option value="Actif">Actif</option>
                <option value="Inactif">Inactif</option>
              </select>
            </label>
          </div>
        </div>
      </div>
  
      <!-- Subscriptions Table -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>CODE</th>
              <th>D√âSIGNATION</th>
              <th>DUR√âE (MOIS)</th>
              <th>FORFAIT</th>
              <th>ACC√àS LIBRE</th>
              <th>S√âANCES/SEMAINE</th>
              <th>STATUT</th>
              <th>ACTIONS</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let subscription of filteredSubscriptions; let i = index"
              class="animate-slide-in-right"
              [ngClass]="'animation-delay-' + (i * 100)"
            >
              <td>{{ subscription.code }}</td>
              <td>{{ subscription.designation }}</td>
              <td>{{ subscription.duration }}</td>
              <td>{{ subscription.price }} DT</td>
              <td>
                <span class="access" [ngClass]="subscription.freeAccess ? 'yes' : 'no'">{{ subscription.freeAccess ? 'Oui' : 'Non' }}</span>
              </td>
              <td>{{ subscription.weeklySessions === -1 ? 'Illimit√©' : subscription.weeklySessions }}</td>
              <td>
                <button class="status-btn" [ngClass]="subscription.status === 'Actif' ? 'active' : 'inactive'" (click)="toggleStatus(subscription)">
                  {{ subscription.status }}
                </button>
              </td>
              <td class="actions">
                <button class="action-btn view" (click)="viewSubscription(subscription)" title="Voir">üëÅÔ∏è</button>
                <button class="action-btn edit" (click)="openEditSubscriptionModal(subscription)" title="√âditer">‚úèÔ∏è</button>
                <button class="action-btn delete" (click)="confirmDeleteSubscription(subscription)" title="Supprimer">üóëÔ∏è</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>