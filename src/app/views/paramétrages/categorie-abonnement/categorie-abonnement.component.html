<div class="gestion-categories-container">
  <div class="gestion-categories">
    <!-- Modal for Adding/Editing a Category -->
    <div class="modal" *ngIf="showModal" @modalAnimation>
      <div class="modal-content">
        <h2 class="modal-title">{{ isEditMode ? 'Modifier la cat√©gorie' : 'Ajouter une cat√©gorie' }}</h2>
        <form (ngSubmit)="saveCategorie()" #categorieForm="ngForm">
          <div class="form-group">
            <label>D√©signation</label>
            <input
              type="text"
              [(ngModel)]="newCategorie.designation"
              name="designation"
              required
              #designation="ngModel"
              class="form-input"
              placeholder="Entrez la d√©signation"
            />
            <span class="error" *ngIf="designation.invalid && designation.touched">La d√©signation est requise</span>
          </div>
          <div class="form-group">
            <label>Description</label>
            <textarea
              [(ngModel)]="newCategorie.description"
              name="description"
              required
              #description="ngModel"
              class="form-input"
              placeholder="Entrez la description"
            ></textarea>
            <span class="error" *ngIf="description.invalid && description.touched">La description est requise</span>
          </div>
          <div class="form-group">
            <label>Statut</label>
            <select [(ngModel)]="newCategorie.statut" name="statut" required class="form-input">
              <option value="Actif">Actif</option>
              <option value="Inactif">Inactif</option>
            </select>
          </div>
          <div class="modal-actions">
            <button type="button" class="cancel-btn" (click)="closeModal()">Annuler</button>
            <button type="submit" class="save-btn" [disabled]="!categorieForm.valid">Enregistrer</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Header Section -->
    <div class="header">
      <div class="header-title">
        <h1 class="text-blue-800 animate-fade-in">Cat√©gories d'Abonnement</h1>
        <p class="text-gray-600 animate-fade-in">Liste des cat√©gories d'abonnement ({{ filteredCategories.length }} cat√©gories)</p>
      </div>
      <button class="add-btn bg-blue-600 hover:bg-blue-700 text-white" (click)="openAddModal()">+ Ajouter une cat√©gorie</button>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-filter">
      <div class="search">
        <input
          type="text"
          placeholder="Rechercher une cat√©gorie..."
          [(ngModel)]="searchTerm"
          (input)="filterCategories()"
          class="search-input"
        />
        <span class="search-icon">üîç</span>
      </div>
      <div class="filter-container">
        <button class="filter-btn" (click)="toggleFilterDropdown()">Filtrer ‚ñº</button>
        <div class="filter-dropdown" *ngIf="showFilterDropdown">
          <label class="filter-label">
            Statut :
            <select [(ngModel)]="filterStatut" (change)="filterCategories()" class="filter-select">
              <option value="">Tous</option>
              <option value="Actif">Actif</option>
              <option value="Inactif">Inactif</option>
            </select>
          </label>
        </div>
      </div>
    </div>

    <!-- Categories Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Code</th>
            <th>D√©signation</th>
            <th>Description</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let categorie of filteredCategories; let i = index"
            class="animate-slide-in-right"
            [ngClass]="'animation-delay-' + (i * 100)"
          >
            <td>{{ categorie.code }}</td>
            <td>{{ categorie.designation }}</td>
            <td>{{ categorie.description }}</td>
            <td>
              <span class="status" [ngClass]="categorie.statut === 'Actif' ? 'active' : 'inactive'" (click)="toggleStatut(categorie)">
                {{ categorie.statut }}
              </span>
            </td>
            <td class="actions">
              <button class="action-btn view" (click)="voirCategorie(categorie)" title="Voir">üëÅÔ∏è</button>
              <button class="action-btn edit" (click)="openEditModal(categorie)" title="√âditer">‚úèÔ∏è</button>
              <button class="action-btn delete" (click)="confirmDeleteCategorie(categorie)" title="Supprimer">üóëÔ∏è</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Modal for Viewing a Category -->
    <div class="modal" *ngIf="showViewModal" @modalAnimation>
      <div class="modal-content">
        <h2 class="modal-title">D√©tails de la cat√©gorie</h2>
        <div class="user-details">
          <p><strong>Code :</strong> {{ viewedCategorie?.code }}</p>
          <p><strong>D√©signation :</strong> {{ viewedCategorie?.designation }}</p>
          <p><strong>Description :</strong> {{ viewedCategorie?.description }}</p>
          <p><strong>Statut :</strong> <span [ngClass]="viewedCategorie?.statut === 'Actif' ? 'active' : 'inactive'">{{ viewedCategorie?.statut }}</span></p>
        </div>
        <div class="modal-actions">
          <button class="close-btn" (click)="closeViewModal()">Fermer</button>
        </div>
      </div>
    </div>

    <!-- Modal for Delete Confirmation -->
    <div class="modal" *ngIf="showDeleteConfirm" @modalAnimation>
      <div class="modal-content">
        <h2 class="modal-title">Confirmer la suppression</h2>
        <p class="modal-text">√ätes-vous s√ªr de vouloir supprimer la cat√©gorie {{ categorieToDelete?.designation }} ?</p>
        <div class="modal-actions">
          <button class="cancel-btn" (click)="cancelDelete()">Annuler</button>
          <button class="delete-btn" (click)="supprimerCategorie()">Supprimer</button>
        </div>
      </div>
    </div>
  </div>
</div>